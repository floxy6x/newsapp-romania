<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Știri România - Live News Feed</title>

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#1a73e8">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Știri România">
    <meta name="description" content="Aplicația completă de știri din România cu actualizări în timp real">
    
    <!-- Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%231a73e8'/><text y='70' font-size='50' fill='white'>📰</text></svg>">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%231a73e8'/><text y='70' font-size='50' fill='white'>📰</text></svg>">

    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #1557b0;
            --secondary: #f8f9fa;
            --accent: #ff6b35;
            --text: #202124;
            --text-secondary: #5f6368;
            --border: #dadce0;
            --shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            --shadow-hover: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Google Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text);
        }
        
        .app-container {
            min-height: 100vh;
            background: var(--secondary);
            max-width: 1200px;
            margin: 0 auto;
            box-shadow: var(--shadow);
        }
        
        /* Header Professional */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 16px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }
        
        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 700;
            text-decoration: none;
            color: white;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .action-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .action-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }
        
        .live-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            background: var(--accent);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .live-dot {
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Search Bar */
        .search-container {
            margin-top: 16px;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 25px;
            padding: 12px 50px 12px 20px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .search-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--primary);
            border: none;
            color: white;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Categories */
        .categories {
            background: white;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .categories::-webkit-scrollbar {
            height: 4px;
        }
        
        .categories::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .categories::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 2px;
        }
        
        .categories-list {
            display: flex;
            gap: 12px;
            min-width: max-content;
        }
        
        .category-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f8f9fa;
            border: 2px solid transparent;
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .category-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .category-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary-dark);
        }
        
        /* News Status Bar */
        .news-status {
            background: #e8f5e8;
            border-left: 4px solid #4caf50;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 14px;
        }
        
        .news-status.warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            color: #856404;
        }
        
        .news-status.error {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
        }
        
        .news-status.success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
        }
        
        .status-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .refresh-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .refresh-btn:hover {
            background: #45a049;
        }
        
        /* News Grid */
        .news-container {
            padding: 20px;
            background: #f8f9fa;
        }
        
        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Featured Article */
        .featured-article {
            grid-column: 1 / -1;
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .featured-article:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }
        
        .featured-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 0;
        }
        
        .featured-text {
            padding: 24px;
        }
        
        .featured-badge {
            display: inline-block;
            background: var(--accent);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .featured-title {
            font-size: 28px;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 12px;
            color: var(--text);
        }
        
        .featured-summary {
            font-size: 16px;
            line-height: 1.5;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }
        
        .featured-meta {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .featured-image {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            color: white;
            position: relative;
        }
        
        /* Regular News Cards */
        .news-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .news-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }
        
        .news-image {
            height: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
            position: relative;
        }
        
        .news-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 6px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .bookmark-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 36px;
            height: 36px;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .bookmark-btn:hover {
            background: white;
            transform: scale(1.1);
        }
        
        .bookmark-btn.bookmarked {
            background: #ffd700;
            color: white;
        }
        
        .news-content {
            padding: 20px;
        }
        
        .news-title {
            font-size: 18px;
            font-weight: 600;
            line-height: 1.3;
            margin-bottom: 10px;
            color: var(--text);
        }
        
        .news-summary {
            font-size: 14px;
            line-height: 1.4;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }
        
        .news-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .news-meta {
            display: flex;
            gap: 16px;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .news-actions {
            display: flex;
            gap: 8px;
        }
        
        .action-icon {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 6px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .action-icon:hover {
            background: #f0f0f0;
            color: var(--primary);
        }
        
        /* Loading States */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--text-secondary);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Error States */
        .error {
            background: #ffebee;
            border: 1px solid #ffcdd2;
            border-radius: 8px;
            padding: 20px;
            margin: 20px;
            text-align: center;
            color: #d32f2f;
        }
        
        .retry-btn {
            background: #d32f2f;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 12px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header {
                padding: 12px 16px;
            }
            
            .logo {
                font-size: 20px;
            }
            
            .featured-content {
                grid-template-columns: 1fr;
            }
            
            .featured-image {
                height: 200px;
            }
            
            .news-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .categories {
                padding: 12px 16px;
            }
            
            .news-container {
                padding: 16px;
            }
        }
        
        @media (max-width: 480px) {
            .featured-title {
                font-size: 22px;
            }
            
            .news-title {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-top">
                <a href="#" class="logo">
                    <div class="logo-icon">📰</div>
                    <span>Știri România</span>
                </a>
                
                <div class="header-actions">
                    <div class="live-indicator">
                        <div class="live-dot"></div>
                        LIVE
                    </div>
                    <button class="action-btn" id="refreshBtn" title="Actualizează">🔄</button>
                    <button class="action-btn" id="settingsBtn" title="Setări">⚙️</button>
                </div>
            </div>
            
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="Caută știri în timp real...">
                <button class="search-btn" id="searchSubmit">🔍</button>
            </div>
        </header>

        <!-- Categories -->
        <div class="categories">
            <div class="categories-list" id="categoriesList">
                <button class="category-btn active" data-category="general">📰 Toate</button>
                <button class="category-btn" data-category="business">💼 Business</button>
                <button class="category-btn" data-category="technology">💻 Tech</button>
                <button class="category-btn" data-category="sports">⚽ Sport</button>
                <button class="category-btn" data-category="health">🏥 Sănătate</button>
                <button class="category-btn" data-category="entertainment">🎬 Entertainment</button>
                <button class="category-btn" data-category="science">🔬 Știință</button>
            </div>
        </div>

        <!-- News Status -->
        <div class="news-status" id="newsStatus">
            <div class="status-info">
                <span>📡</span>
                <span id="statusText">Încărcare știri...</span>
            </div>
            <button class="refresh-btn" id="manualRefresh">Actualizează</button>
        </div>

        <!-- News Container -->
        <div class="news-container">
            <div class="news-grid" id="newsGrid">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Se încarcă știrile în timp real...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        class NewsApp {
            constructor() {
                this.currentCategory = 'general';
                this.searchQuery = '';
                this.isLoading = false;
                this.bookmarkedNews = this.loadBookmarks();
                this.lastUpdate = null;
                this.autoRefreshInterval = null;
                this.allArticles = []; // Store all articles
                
                // RSS Sources organized by category
                this.rssSources = {
                    general: [
                        'https://www.digi24.ro/rss',
                        'https://www.hotnews.ro/rss', 
                        'https://www.libertatea.ro/rss',
                        'https://www.g4media.ro/feed'
                    ],
                    business: [
                        'https://www.zf.ro/rss',
                        'https://economie.hotnews.ro/rss',
                        'https://www.digi24.ro/rss/economic',
                        'https://www.libertatea.ro/rss/economic'
                    ],
                    technology: [
                        'https://www.digi24.ro/rss/stiinta-tehnologie',
                        'https://www.hotnews.ro/rss/esential',
                        'https://www.libertatea.ro/rss/tehnologie',
                        'https://www.zf.ro/rss'
                    ],
                    sports: [
                        'https://www.digi24.ro/rss/sport',
                        'https://sport.hotnews.ro/rss',
                        'https://www.libertatea.ro/rss/sport',
                        'https://www.prosport.ro/rss/'
                    ],
                    health: [
                        'https://www.digi24.ro/rss/sanatate',
                        'https://www.hotnews.ro/rss/sanatate',
                        'https://www.libertatea.ro/rss/sanatate',
                        'https://www.digi24.ro/rss/stiri'
                    ],
                    entertainment: [
                        'https://www.libertatea.ro/rss/vedete',
                        'https://www.digi24.ro/rss/showbiz',
                        'https://www.hotnews.ro/rss/cultura',
                        'https://www.cancan.ro/rss/'
                    ],
                    science: [
                        'https://www.digi24.ro/rss/stiinta-tehnologie',
                        'https://www.hotnews.ro/rss/stiinta',
                        'https://www.libertatea.ro/rss/sanatate',
                        'https://www.digi24.ro/rss/externe'
                    ]
                };
                
                // Fallback news for each category
                this.fallbackNews = this.generateFallbackNews();
                
                this.initializeApp();
            }
            
            loadBookmarks() {
                try {
                    return JSON.parse(localStorage.getItem('bookmarkedNews') || '[]');
                } catch {
                    return [];
                }
            }
            
            saveBookmarks() {
                try {
                    localStorage.setItem('bookmarkedNews', JSON.stringify(this.bookmarkedNews));
                } catch {
                    console.warn('Cannot save bookmarks - localStorage not available');
                }
            }
            
            generateFallbackNews() {
                return {
                    general: [
                        {
                            id: 'demo-general-1',
                            title: 'România înregistrează creștere economică record în acest trimestru',
                            summary: 'Economia românească a înregistrat o creștere semnificativă, consolidând poziția țării pe piața europeană și atrăgând noi investiții străine.',
                            link: '#',
                            pubDate: new Date(Date.now() - 2 * 60 * 60 * 1000),
                            source: 'Știri România',
                            category: 'general',
                            image: '📈',
                            views: '2.1k'
                        }
                    ],
                    business: [
                        {
                            id: 'demo-biz-1',
                            title: 'Investiții majore în sectorul energetic românesc',
                            summary: 'Companii internaționale anunță investiții de miliarde de euro în energia regenerabilă din România, consolidând independența energetică.',
                            link: '#',
                            pubDate: new Date(Date.now() - 1 * 60 * 60 * 1000),
                            source: 'Business România',
                            category: 'business',
                            image: '💰',
                            views: '1.8k'
                        }
                    ],
                    technology: [
                        {
                            id: 'demo-tech-1',
                            title: 'Startup-uri românești atrag investiții record în tehnologie',
                            summary: 'Ecosistemul de inovare din România continuă să crească, cu noi companii tech care obțin finanțări importante pentru dezvoltare.',
                            link: '#',
                            pubDate: new Date(Date.now() - 3 * 60 * 60 * 1000),
                            source: 'Tech România',
                            category: 'technology',
                            image: '💻',
                            views: '1.5k'
                        }
                    ],
                    sports: [
                        {
                            id: 'demo-sport-1',
                            title: 'Echipa națională de fotbal pregătește meciuri importante',
                            summary: 'Selecționerul a anunțat lotul pentru următoarele meciuri internaționale, cu surprize în componența echipei naționale.',
                            link: '#',
                            pubDate: new Date(Date.now() - 4 * 60 * 60 * 1000),
                            source: 'Sport Total',
                            category: 'sports',
                            image: '⚽',
                            views: '3.2k'
                        }
                    ],
                    health: [
                        {
                            id: 'demo-health-1',
                            title: 'Progrese importante în cercetarea medicală românească',
                            summary: 'Cercetători români fac pași importanți în dezvoltarea de noi tratamente și terapii medicale inovatoare.',
                            link: '#',
                            pubDate: new Date(Date.now() - 5 * 60 * 60 * 1000),
                            source: 'Sănătate Plus',
                            category: 'health',
                            image: '🏥',
                            views: '1.9k'
                        }
                    ],
                    entertainment: [
                        {
                            id: 'demo-ent-1',
                            title: 'Festival de film românesc câștigă premii internaționale',
                            summary: 'Cinematografia românească este din nou în atenția internațională cu producții care obțin recunoaștere globală.',
                            link: '#',
                            pubDate: new Date(Date.now() - 6 * 60 * 60 * 1000),
                            source: 'Cinema Arte',
                            category: 'entertainment',
                            image: '🎬',
                            views: '2.7k'
                        }
                    ],
                    science: [
                        {
                            id: 'demo-science-1',
                            title: 'Lansare cu succes a unui nou satelit românesc',
                            summary: 'România continuă să se afirme în domeniul tehnologiei spațiale cu lansarea unui satelit pentru monitorizarea mediului.',
                            link: '#',
                            pubDate: new Date(Date.now() - 7 * 60 * 60 * 1000),
                            source: 'Space România',
                            category: 'science',
                            image: '🛰️',
                            views: '1.7k'
                        }
                    ]
                };
            }
            
            initializeApp() {
                console.log('🚀 Inițializez aplicația de știri România...');
                this.setupEventListeners();
                this.loadAllNews();
                this.startAutoRefresh();
                this.updateLastRefreshTime();
            }
            
            setupEventListeners() {
                // Search functionality
                const searchInput = document.getElementById('searchInput');
                const searchSubmit = document.getElementById('searchSubmit');
                
                searchInput?.addEventListener('input', (e) => {
                    clearTimeout(this.searchTimeout);
                    this.searchTimeout = setTimeout(() => {
                        this.searchQuery = e.target.value.toLowerCase();
                        this.filterAndRenderNews();
                    }, 300);
                });
                
                searchSubmit?.addEventListener('click', () => {
                    this.searchQuery = searchInput?.value.toLowerCase() || '';
                    this.filterAndRenderNews();
                });
                
                // Category selection
                document.getElementById('categoriesList')?.addEventListener('click', (e) => {
                    if (e.target.classList.contains('category-btn')) {
                        this.selectCategory(e.target);
                    }
                });
                
                // Refresh buttons
                document.getElementById('refreshBtn')?.addEventListener('click', () => this.loadAllNews(true));
                document.getElementById('manualRefresh')?.addEventListener('click', () => this.loadAllNews(true));
                
                // Settings
                document.getElementById('settingsBtn')?.addEventListener('click', () => this.showSettings());
            }
            
            selectCategory(button) {
                // Update UI
                document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                
                // Update category
                const newCategory = button.dataset.category;
                console.log(`🎯 Switching to category: ${newCategory}`);
                
                this.currentCategory = newCategory;
                this.searchQuery = '';
                
                // Clear search
                const searchInput = document.getElementById('searchInput');
                if (searchInput) searchInput.value = '';
                
                // Filter and render
                this.filterAndRenderNews();
            }
            
            async loadAllNews(forceRefresh = false) {
                if (this.isLoading && !forceRefresh) return;
                
                this.isLoading = true;
                this.updateStatus('🔄 Sincronizez știrile din toate categoriile...', 'loading');
                
                console.log('📡 Loading news from all categories...');
                
                try {
                    const allArticles = [];
                    let totalSuccessfulSources = 0;
                    
                    // Load news from all categories with better error handling
                    for (const [category, sources] of Object.entries(this.rssSources)) {
                        console.log(`\n🎯 Loading ${category} news...`);
                        try {
                            const categoryArticles = await this.fetchCategoryNews(category, sources);
                            allArticles.push(...categoryArticles);
                            if (categoryArticles.length > 0) {
                                totalSuccessfulSources++;
                            }
                        } catch (error) {
                            console.warn(`❌ Failed to load ${category}:`, error);
                            // Add fallback news for this category
                            if (this.fallbackNews[category]) {
                                allArticles.push(...this.fallbackNews[category]);
                                console.log(`📰 Using fallback news for ${category}`);
                            }
                        }
                    }
                    
                    console.log(`\n📰 Total articles collected: ${allArticles.length} from ${totalSuccessfulSources} categories`);
                    
                    if (allArticles.length === 0) {
                        console.log('📰 No articles at all - using all fallback news');
                        this.allArticles = this.getAllFallbackNews();
                        this.updateStatus('📰 Afișez știri demo - RSS complet indisponibil', 'warning');
                    } else if (totalSuccessfulSources < 3) {
                        // Mix real articles with some fallback
                        const fallbackArticles = this.getAllFallbackNews();
                        this.allArticles = this.processArticles([...allArticles, ...fallbackArticles]);
                        this.updateStatus(`⚠️ Parțial actualizat: ${allArticles.length} reale + demo (${totalSuccessfulSources}/7 categorii)`, 'warning');
                    } else {
                        this.allArticles = this.processArticles(allArticles);
                        this.updateStatus(`✅ Actualizat: ${new Date().toLocaleTimeString('ro-RO')} (${this.allArticles.length} știri din ${totalSuccessfulSources}/7 categorii)`, 'success');
                    }
                    
                    this.filterAndRenderNews();
                    this.lastUpdate = new Date();
                    
                } catch (error) {
                    console.error('❌ Critical error loading news:', error);
                    this.allArticles = this.getAllFallbackNews();
                    this.filterAndRenderNews();
                    this.updateStatus('⚠️ Folosesc știrile demo - problema de conectivitate', 'error');
                } finally {
                    this.isLoading = false;
                }
            }
            
            getAllFallbackNews() {
                const allNews = [];
                for (const [category, articles] of Object.entries(this.fallbackNews)) {
                    allNews.push(...articles);
                }
                return allNews;
            }
            
            async fetchCategoryNews(category, sources) {
                const articles = [];
                let successCount = 0;
                
                console.log(`🎯 Fetching ${category} from ${sources.length} sources...`);
                
                for (let i = 0; i < sources.length; i++) {
                    const rssUrl = sources[i];
                    try {
                        console.log(`🔄 Trying source ${i + 1}/${sources.length}: ${rssUrl}`);
                        
                        // Try RSS2JSON
                        const rss2jsonUrl = `https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`;
                        const response = await fetch(rss2jsonUrl);
                        
                        if (response.ok) {
                            const data = await response.json();
                            if (data.status === 'ok' && data.items && data.items.length > 0) {
                                const parsedArticles = this.parseRSSItems(data.items, category);
                                articles.push(...parsedArticles);
                                successCount++;
                                console.log(`✅ ${category} source ${i + 1}: ${parsedArticles.length} articles`);
                                
                                // Stop after getting enough articles from 2 successful sources
                                if (successCount >= 2 && articles.length >= 10) {
                                    console.log(`🎯 ${category}: Got enough articles, stopping early`);
                                    break;
                                }
                            } else {
                                console.warn(`⚠️ ${category} source ${i + 1}: Invalid RSS data`);
                            }
                        } else {
                            console.warn(`❌ ${category} source ${i + 1}: HTTP ${response.status}`);
                        }
                    } catch (error) {
                        console.warn(`❌ ${category} source ${i + 1} failed:`, error.message);
                    }
                    
                    // Small delay between requests to avoid rate limiting
                    if (i < sources.length - 1) {
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }
                
                console.log(`📊 ${category}: ${articles.length} total articles from ${successCount}/${sources.length} sources`);
                return articles;
            }
            
            parseRSSItems(items, category) {
                const articles = [];
                
                items.forEach((item, index) => {
                    try {
                        if (!item.title || !item.link) return;
                        
                        const cleanTitle = this.cleanText(item.title);
                        const cleanSummary = this.extractSummary(item.description || item.content);
                        
                        articles.push({
                            id: this.generateId(cleanTitle + item.link + category + index),
                            title: cleanTitle,
                            summary: cleanSummary,
                            link: item.link,
                            pubDate: new Date(item.pubDate || Date.now()),
                            source: this.extractSource(item.link),
                            category: category,
                            image: this.getRandomEmoji(category),
                            views: this.generateViews(),
                            bookmarked: false
                        });
                    } catch (error) {
                        console.warn('Parse error:', error);
                    }
                });
                
                return articles;
            }
            
            processArticles(articles) {
                // Remove duplicates
                const uniqueArticles = articles.filter((article, index, self) =>
                    index === self.findIndex(a => 
                        a.title.toLowerCase() === article.title.toLowerCase() || 
                        a.link === article.link
                    )
                );
                
                // Update bookmarked status
                uniqueArticles.forEach(article => {
                    article.bookmarked = this.bookmarkedNews.includes(article.id);
                });
                
                console.log(`🔧 Processed: ${articles.length} → ${uniqueArticles.length} unique articles`);
                
                return uniqueArticles
                    .sort((a, b) => b.pubDate - a.pubDate)
                    .slice(0, 200); // Keep more articles
            }
            
            filterAndRenderNews() {
                if (!this.allArticles) return;
                
                let filteredArticles = [...this.allArticles];
                
                // Apply category filter
                if (this.currentCategory !== 'general') {
                    filteredArticles = filteredArticles.filter(article => 
                        article.category === this.currentCategory
                    );
                    console.log(`📂 Category filter (${this.currentCategory}): ${filteredArticles.length} articles`);
                }
                
                // Apply search filter
                if (this.searchQuery) {
                    filteredArticles = filteredArticles.filter(article =>
                        article.title.toLowerCase().includes(this.searchQuery) ||
                        article.summary.toLowerCase().includes(this.searchQuery) ||
                        article.source.toLowerCase().includes(this.searchQuery)
                    );
                    console.log(`🔍 Search filter "${this.searchQuery}": ${filteredArticles.length} articles`);
                }
                
                this.renderNews(filteredArticles);
            }
            
            renderNews(articles) {
                const newsGrid = document.getElementById('newsGrid');
                if (!newsGrid) return;
                
                if (articles.length === 0) {
                    newsGrid.innerHTML = `
                        <div class="error">
                            <h3>😔 Nu s-au găsit știri</h3>
                            <p>Încearcă să modifici criteriile de căutare sau categoria.</p>
                        </div>
                    `;
                    return;
                }
                
                // Featured article (first one)
                const [featured, ...regular] = articles;
                
                const html = `
                    ${this.renderFeaturedArticle(featured)}
                    ${regular.slice(0, 20).map(article => this.renderRegularArticle(article)).join('')}
                `;
                
                newsGrid.innerHTML = html;
                console.log(`📄 Rendered ${articles.length} articles (1 featured + ${Math.min(20, regular.length)} regular)`);
            }
            
            renderFeaturedArticle(article) {
                return `
                    <article class="featured-article" onclick="window.open('${article.link}', '_blank')">
                        <div class="featured-content">
                            <div class="featured-text">
                                <span class="featured-badge">FEATURED • ${this.getCategoryLabel(article.category)}</span>
                                <h1 class="featured-title">${article.title}</h1>
                                <p class="featured-summary">${article.summary}</p>
                                <div class="featured-meta">
                                    <span>📰 ${article.source}</span>
                                    <span>🕒 ${this.formatTime(article.pubDate)}</span>
                                    <span>👁️ ${article.views}</span>
                                </div>
                            </div>
                            <div class="featured-image">
                                ${article.image}
                                <button class="bookmark-btn ${article.bookmarked ? 'bookmarked' : ''}" 
                                        onclick="event.stopPropagation(); newsApp.toggleBookmark('${article.id}')">
                                    ${article.bookmarked ? '★' : '☆'}
                                </button>
                            </div>
                        </div>
                    </article>
                `;
            }
            
            renderRegularArticle(article) {
                return `
                    <article class="news-card" onclick="window.open('${article.link}', '_blank')">
                        <div class="news-image">
                            ${article.image}
                            <div class="news-badge">${article.source}</div>
                            <button class="bookmark-btn ${article.bookmarked ? 'bookmarked' : ''}" 
                                    onclick="event.stopPropagation(); newsApp.toggleBookmark('${article.id}')">
                                ${article.bookmarked ? '★' : '☆'}
                            </button>
                        </div>
                        <div class="news-content">
                            <h2 class="news-title">${article.title}</h2>
                            <p class="news-summary">${article.summary}</p>
                            <div class="news-footer">
                                <div class="news-meta">
                                    <span>🕒 ${this.formatTime(article.pubDate)}</span>
                                    <span>👁️ ${article.views}</span>
                                    <span>📂 ${this.getCategoryLabel(article.category)}</span>
                                </div>
                                <div class="news-actions">
                                    <button class="action-icon" onclick="event.stopPropagation(); newsApp.shareArticle('${article.id}')" title="Distribuie">📤</button>
                                </div>
                            </div>
                        </div>
                    </article>
                `;
            }
            
            // Utility functions
            generateId(text) {
                let hash = 0;
                const cleanText = text.replace(/[^a-zA-Z0-9]/g, '');
                for (let i = 0; i < cleanText.length; i++) {
                    const char = cleanText.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return Math.abs(hash).toString(36).substr(0, 16);
            }
            
            cleanText(text) {
                if (!text) return '';
                return text
                    .replace(/<[^>]*>/g, '')
                    .replace(/&[^;]+;/g, ' ')
                    .trim()
                    .substr(0, 200);
            }
            
            extractSummary(description) {
                if (!description) return 'Nu este disponibil un rezumat pentru acest articol...';
                
                const cleanDesc = this.cleanText(description);
                if (cleanDesc.length > 150) {
                    return cleanDesc.substr(0, 147) + '...';
                }
                return cleanDesc || 'Rezumat indisponibil...';
            }
            
            extractSource(url) {
                try {
                    const domain = new URL(url).hostname;
                    const sources = {
                        'digi24.ro': 'Digi24',
                        'hotnews.ro': 'HotNews',
                        'libertatea.ro': 'Libertatea',
                        'g4media.ro': 'G4Media',
                        'zf.ro': 'Ziarul Financiar',
                        'wall-street.ro': 'Wall-Street',
                        'prosport.ro': 'ProSport',
                        'gsp.ro': 'Gazeta Sporturilor',
                        'money.ro': 'Money.ro',
                        'start-up.ro': 'Start-up.ro',
                        'cancan.ro': 'CanCan',
                        'click.ro': 'Click!',
                        'adevarul.ro': 'Adevărul',
                        'descopera.ro': 'Descoperă',
                        'scientia.ro': 'Scientia'
                    };
                    
                    for (const [key, value] of Object.entries(sources)) {
                        if (domain.includes(key)) return value;
                    }
                    
                    return domain.replace('www.', '');
                } catch {
                    return 'Necunoscut';
                }
            }
            
            getCategoryLabel(category) {
                const labels = {
                    'general': 'General',
                    'business': 'Business',
                    'technology': 'Tech',
                    'sports': 'Sport',
                    'health': 'Sănătate',
                    'entertainment': 'Entertainment',
                    'science': 'Știință'
                };
                return labels[category] || 'General';
            }
            
            getRandomEmoji(category) {
                const emojis = {
                    general: ['📰', '📺', '🗞️', '📻', '🎤'],
                    business: ['💼', '💰', '📈', '🏢', '💳'],
                    technology: ['💻', '📱', '🔬', '🚀', '⚡'],
                    sports: ['⚽', '🏀', '🎾', '🏆', '🥇'],
                    health: ['🏥', '💊', '🔬', '🩺', '🧪'],
                    entertainment: ['🎬', '🎭', '🎵', '🎪', '🎨'],
                    science: ['🔬', '🧪', '🔭', '🌌', '🧬']
                };
                
                const categoryEmojis = emojis[category] || emojis.general;
                return categoryEmojis[Math.floor(Math.random() * categoryEmojis.length)];
            }
            
            generateViews() {
                return (Math.floor(Math.random() * 10000) + 100).toLocaleString('ro-RO');
            }
            
            formatTime(date) {
                const now = new Date();
                const diff = now - date;
                const minutes = Math.floor(diff / 60000);
                const hours = Math.floor(minutes / 60);
                const days = Math.floor(hours / 24);
                
                if (minutes < 60) return `${minutes}m`;
                if (hours < 24) return `${hours}h`;
                return `${days}z`;
            }
            
            updateStatus(message, type = 'info') {
                const statusText = document.getElementById('statusText');
                const statusBar = document.getElementById('newsStatus');
                
                if (statusText) {
                    statusText.textContent = message;
                }
                
                if (statusBar) {
                    statusBar.classList.remove('success', 'warning', 'error');
                    if (type !== 'info') {
                        statusBar.classList.add(type);
                    }
                }
            }
            
            startAutoRefresh() {
                if (this.autoRefreshInterval) {
                    clearInterval(this.autoRefreshInterval);
                }
                
                this.autoRefreshInterval = setInterval(() => {
                    console.log('⏰ Auto-refresh triggered');
                    this.loadAllNews(true);
                }, 15 * 60 * 1000); // 15 minutes
                
                console.log('⏰ Auto-refresh set for every 15 minutes');
            }
            
            updateLastRefreshTime() {
                setInterval(() => {
                    if (this.lastUpdate) {
                        const elapsed = Math.floor((new Date() - this.lastUpdate) / 1000);
                        const minutes = Math.floor(elapsed / 60);
                        
                        if (elapsed < 60) {
                            this.updateStatus(`✅ Actualizat acum ${elapsed}s`, 'success');
                        } else if (minutes < 60) {
                            this.updateStatus(`✅ Actualizat acum ${minutes}m`, 'success');
                        } else {
                            const hours = Math.floor(minutes / 60);
                            this.updateStatus(`✅ Actualizat acum ${hours}h ${minutes % 60}m`, 'success');
                        }
                    }
                }, 30000);
            }
            
            toggleBookmark(articleId) {
                const index = this.bookmarkedNews.indexOf(articleId);
                if (index > -1) {
                    this.bookmarkedNews.splice(index, 1);
                } else {
                    this.bookmarkedNews.push(articleId);
                }
                
                this.saveBookmarks();
                
                // Update article in memory
                const article = this.allArticles.find(a => a.id === articleId);
                if (article) {
                    article.bookmarked = !article.bookmarked;
                    this.filterAndRenderNews();
                }
            }
            
            shareArticle(articleId) {
                const article = this.allArticles?.find(a => a.id === articleId);
                if (!article) return;
                
                if (navigator.share) {
                    navigator.share({
                        title: article.title,
                        text: article.summary,
                        url: article.link
                    }).catch(console.error);
                } else {
                    navigator.clipboard.writeText(article.link).then(() => {
                        alert('Link-ul a fost copiat în clipboard!');
                    }).catch(() => {
                        alert('Nu s-a putut copia link-ul');
                    });
                }
            }
            
            showSettings() {
                alert(`⚙️ Setări Aplicație Știri România:

• Auto-refresh: 15 minute
• Surse per categorie: 4 RSS feeds
• Articole maxime: 200
• Categorii: 7 disponibile
• Bookmarks: ${this.bookmarkedNews.length} salvate

Aplicația funcționează complet offline după prima încărcare!`);
            }
        }
        
        // Initialize the app
        let newsApp;
        document.addEventListener('DOMContentLoaded', () => {
            newsApp = new NewsApp();
        });
    </script>
</body>
</html>
